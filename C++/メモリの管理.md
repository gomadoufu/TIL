# メモリの管理

## メモリの種類

### スタック

データ構造上、ヒープに比べて高速に扱える。
スタックへのメモリの確保と解放はコンパイラ・OSがやってくれる

使用できるスタックには限りがあるので、大きなデータを取り扱うのには向かない。また、使用されるスタック領域は静的に決定されるので、実行前にメモリの確保期間がわかるものにしか使用されない。

```c++
void Function() {
    int x = 100; // ローカル変数xはスタックに確保される。
    int y = 200; // ローカル変数yはスタックに確保される。

} // 関数の終了とともに変数 x, y はスタックから取り除かれる。
  // スタックはLIFO（後入れ先出し）形式のため y, x の順で取り除かれる。

int main() {
    Function();

    return 0;
}
```



### ヒープ

プログラム実行時に動的に変化する。スタックより自由度が高い。OSは面倒をみてくれないので、メモリの確保と解放を行う必要がある。

メモリの確保期間が明確でない場合や、実行時にサイズが確定するようなものについてはヒープを利用する。例えば、 `std::vector`は、保持する要素をヒープ上に確保することで、要素数を実行時に変更できるという仕組みを実現している。



## メモリ確保・解放

### 確保

newを使う。
```c++
int* p1 = new int(100);  // p1 は new で確保されたメモリ領域を指すポインタ
int* p2 = new int[5];    // 配列の場合は [] を付ける
```

### 解放

deleteを使う。
```c++
int* p1 = new int(100);
int* p2 = new int[5];

delete p1;    // new によって確保されたメモリを delete で解放
delete[] p2;  // 配列の場合は [] を付ける
```



**確保した後解放しないと、メモリリークするので注意**
**malloc/freeはC++では非推奨**