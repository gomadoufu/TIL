# テストの体系化

Rustではテストを2つの大きなカテゴリで捉えている: **単体テスト**と**結合テスト**。



### 単体テスト

単体テストの目的は、残りのコードから切り離して各単位のコードをテストし、 コードが想定通り、動いたり動いていなかったりする箇所を迅速に特定すること。

単体テストは、テスト対象となるコードと共に、*src*ディレクトリの各ファイルに置く。
 慣習は、各ファイルに`tests`という名前のモジュールを作り、そのモジュールを`cfg(test)`で注釈すること。

#### テストモジュールと#[cfg(test)]

`tests`モジュールの`#[cfg(test)]`という注釈は、コンパイラに`cargo build`を走らせた時ではなく、`cargo test`を走らせた時にだけ、 テストコードをコンパイルし走らせるよう指示する。
結合テストと異なり、単体テストはコードと同じファイルに存在するので、 `#[cfg(test)]`を使用してコンパイル結果に含まれないよう指定する必要がある。

`cfg`という属性は、*configuration*を表していて、 括弧の中には設定オプションを含める。今回の場合、設定オプションは、`test`である。



### 結合テスト

結合テストは、完全にライブラリ外のものであり、他の人が書いたコードと同様に、公開APIの一部しか呼び出すことができない。

結合テストの目的は、ライブラリのいろんな部分が、共同で正常に動作しているかをテストすること。単体では正常に動くコードも、結合した状態だと問題を起こす可能性がある。

結合テストを作成するには、まず**testsディレクトリ**が必要になる。

#### testsディレクトリ

プロジェクトディレクトリのトップ階層、*src*の隣に*tests*ディレクトリを作成する。
 Cargoは、このディレクトリに結合テストのファイルがあることを把握している。

testsディレクトリ内にはいくつでもテストファイルを作成することができ、 Cargoはそれぞれのファイルを個別のクレートとしてコンパイルする。

testsディレクトリ内のファイルは、`#[cfg(test)]`で注釈する必要はない。

